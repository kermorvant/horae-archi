{% extends "base.html" %}

{% block content %}

<div class="level" style="margin-bottom: 0.5rem;">

</div>

<div class="columns" style="width: 100%; margin: 0;">
    
    <!-- LEFT FILTER COLUMN -->
    <div class="column is-2" style="min-width: 260px;">

        <div style="
            position: sticky;
            top: 0;
            max-height: 100vh;      /* limit to viewport height */
            overflow-y: auto;       /* enable scrolling */
            padding-top: 1rem;
            padding-bottom: 1rem;
        ">

            <form method="POST" class="box" style="height: fit-content;">

                <h1 class="title is-4">Search</h1>

                <!-- GLOBAL SEARCH -->
                <div class="field">
                    <label class="label">Global keyword search</label>
                    <div class="control">
                        <input class="input" type="text" name="query" 
                               placeholder="keywords..."
                               value="{{ query }}">
                    </div>
                </div>

                <div class="field">
                    <label class="label">Description</label>
                    <input class="input" type="text" name="f_scene_desc"
                            placeholder="praying, agriculture..."
                           value="{{ f_scene_desc }}">
                </div>

                <div class="field">
                    <label class="label">Interpretation</label>
                    <input class="input" type="text" name="f_scene_interp"
                         placeholder="Visitation, Crucifixion..."
                           value="{{ f_scene_interp }}">
                </div>

                <div class="field">
                    <label class="label">Spatial context</label>
                    <div class="select is-fullwidth">
                        <select name="f_spatial">
                            <option value=""></option>
                            <option value="indoor" {% if f_spatial == "indoor" %}selected{% endif %}>indoor</option>
                            <option value="outdoor" {% if f_spatial == "outdoor" %}selected{% endif %}>outdoor</option>
                            <option value="mixed_indoor_outdoor" {% if f_spatial == "mixed_indoor_outdoor" %}selected{% endif %}>mixed</option>
                            <option value="metaphysical" {% if f_spatial == "metaphysical" %}selected{% endif %}>metaphysical</option>
                        </select>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Architectural context</label>
                    <div class="select is-fullwidth">
                        <select name="f_arch">
                            <option value=""></option>
                            <option value="no_architecture" {% if f_arch == "no_architecture" %}selected{% endif %}>no architecture</option>
                            <option value="religious_architecture" {% if f_arch == "religious_architecture" %}selected{% endif %}>religious</option>
                            <option value="civic_architecture" {% if f_arch == "civic_architecture" %}selected{% endif %}>civic</option>
                            <option value="military_architecture" {% if f_arch == "military_architecture" %}selected{% endif %}>military</option>
                            <option value="undefined_architecture" {% if f_arch == "undefined_architecture" %}selected{% endif %}>undefined</option>
                        </select>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Building</label>
                    <input class="input" type="text" name="f_buildings"
                            placeholder="church, walled city..."
                           value="{{ f_buildings }}">
                </div>

                <div class="field">
                    <label class="label">Architectural elements</label>
                    <input class="input" type="text" name="f_elements"
                            placeholder="column, pinacle..."
                           value="{{ f_elements }}">
                </div>

                <div class="field">
                    <label class="label">Persons</label>
                    <input class="input" type="text" name="f_persons"
                            placeholder="John the Baptist, Virgin..."
                           value="{{ f_persons }}">
                </div>

                <div class="field mt-4">
                    <button class="button is-primary is-fullwidth">Search</button>
                </div>

            </form>

        </div>

    </div>

    <!-- RIGHT RESULTS COLUMN (FULL WIDTH) -->
    <div class="column is-10" style="padding-left: 30px;">

    <!-- TOTAL RESULTS -->
    <div class="has-text-grey is-size-4" style="margin-bottom: 0.3rem;">
        {{ total_results }} results found
    </div>

        {% include "pagination.html" %}

            <div class="columns is-multiline" style="margin-top: 20px;">

                {% for rec in results %}
                <div class="column is-one-quarter">  <!-- EXACTLY 4 per row -->
                    <div class="card result-card" style="height: 100%; font-size: 1rem;">

                        <!-- IMAGE -->
                        <div class="card-image" style="padding-top: 5px; text-align:center;">
                            {% if rec.image_url %}
                                <figure class="image">
                                    <img src="{{ rec.image_url }}" 
                                        alt="" 
                                        style="width: 100%; height: auto; border:1px solid #ccc;">
                                </figure>
                            {% endif %}
                        </div>

                        <!-- CARD CONTENT -->
                        <div class="card-content" style="padding: 6px;">
                            <p><strong>Description:</strong><br>
                                <span class="desc-short">{{ rec.scene_description_enriched | truncate(100, True, '...') }}</span>
                                {% if rec.scene_description_enriched and rec.scene_description_enriched|length > 100 %}
                                    <span class="desc-full" style="display:none;">{{ rec.scene_description_enriched }}</span>
                                    <a href="#" class="see-more" title="See more" onclick="event.preventDefault(); toggleDesc(this);" style="margin-left:6px;">ðŸ”½</a>
                                {% endif %}
                            </p>
                            <p><strong>Interpretation:</strong><br>{{ rec.scene_interpretation }}</p>
                            <p><strong>Spatial:</strong>
                                <span class="tag is-primary is-light is-size-7">{{ rec.spatial_context }}</span>
                                 </p>
                            <p><strong>Architecture:</strong> 
                                <span class="tag is-danger is-light is-size-7">{{ rec.architectural_context }}</span>
                                </p>

                            <p><strong>Buildings:</strong><br>
                                {% for b in rec.building_types %}
                                    <span class="tag is-success is-light is-size-7">{{ b }}</span>
                                {% endfor %}
                            </p>

                            <p><strong>Elements:</strong><br>
                                {% for e in rec.architectural_elements %}
                                    <span class="tag is-warning is-light is-size-7">{{ e }}</span>
                                {% endfor %}
                            </p>

                            <p><strong>Persons:</strong><br>
                                {% for p in rec.persons %}
                                    <span class="tag is-info is-light is-size-7">{{ p }}</span>
                                {% endfor %}
                            </p>

                            {% set arkindex_id = rec._filename.replace('.json', '') %}
                            <p style="margin-top: 5px;">
                                <a class="button is-link is-light is-small is-fullwidth"
                                href="https://demo.arkindex.org/element/{{ arkindex_id }}"
                                target="_blank">
                                Arkindex â†’
                                </a>
                            </p>

                        </div>

                    </div>
                </div>
                {% endfor %}

            </div>



        {% include "pagination.html" %}

    </div>

</div>

{% endblock %}


